<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Orion ‚Äì Serverless Smart Inbox AI</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f7fa;
            padding: 40px;
        }

        .container {
            max-width: 800px;
            margin: auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        textarea,
        select,
        input[type="file"] {
            width: 100%;
            margin-bottom: 10px;
            padding: 10px;
            font-size: 14px;
        }

        button {
            padding: 10px 20px;
            margin-top: 5px;
            font-size: 14px;
            cursor: pointer;
        }

        .section {
            margin-top: 35px;
        }

        .result {
            background: #f0f2f5;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-size: 13px;
        }

        .label {
            font-weight: bold;
            margin-top: 10px;
            display: block;
        }

        hr {
            margin: 40px 0;
        }
    </style>
</head>

<body>

    <div class="container">
        <h2>üöÄ Orion ‚Äì Serverless Smart Inbox AI</h2>
        <p>
            Analyze sentiment from messages, translate text across languages,
            and extract insights from documents using AWS-native AI services.
        </p>

        <!-- ========================= -->
        <!-- SENTIMENT ANALYSIS -->
        <!-- ========================= -->
        <div class="section">
            <h3>üì¨ Sentiment Analysis (Text)</h3>

            <textarea id="sentimentMessage" placeholder="Type a message for sentiment analysis..."></textarea>

            <button onclick="analyzeSentiment()">Analyze Sentiment</button>

            <div id="sentimentResult" class="result"></div>
        </div>

        <hr />

        <!-- ========================= -->
        <!-- TRANSLATION -->
        <!-- ========================= -->
        <div class="section">
            <h3>üåç Translate Text</h3>

            <textarea id="translateText" placeholder="Text to translate..."></textarea>

            <label class="label">Source language</label>
            <select id="sourceLang">
                <option value="auto">Auto-detect</option>
                <option value="pt">Portuguese</option>
                <option value="en">English</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
            </select>

            <label class="label">Target language</label>
            <select id="targetLang">
                <option value="en">English</option>
                <option value="pt">Portuguese</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
            </select>

            <button onclick="translateText()">Translate</button>

            <div id="translateResult" class="result"></div>
        </div>

        <hr />

        <!-- ========================= -->
        <!-- DOCUMENT OCR + SENTIMENT -->
        <!-- ========================= -->
        <div class="section">
            <h3>üìÑ Document Sentiment Analysis (OCR)</h3>

            <input type="file" id="documentFile" />

            <button onclick="uploadAndProcessDocument()">
                Upload & Analyze Document
            </button>

            <div id="documentResult" class="result"></div>
        </div>

    </div>

    <script>
        const API_BASE = "https://uyk8va4f3i.execute-api.us-east-1.amazonaws.com";

        /* -------------------------
           Sentiment Analysis
        -------------------------- */
        async function analyzeSentiment() {
            const message = document.getElementById("sentimentMessage").value;
            const resultBox = document.getElementById("sentimentResult");

            if (!message) {
                resultBox.textContent = "Please enter a message.";
                return;
            }

            resultBox.textContent = "Analyzing sentiment...";

            try {
                const res = await fetch(`${API_BASE}/messages`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ message })
                });

                const data = await res.json();

                resultBox.textContent =
                    `Sentiment: ${data.summary.sentiment}\n` +
                    `Priority: ${data.summary.priority}\n\n` +
                    data.summary.message;

            } catch (err) {
                resultBox.textContent = "Error calling sentiment API.";
            }
        }

        /* -------------------------
           Translation
        -------------------------- */
        async function translateText() {
            const text = document.getElementById("translateText").value;
            const source = document.getElementById("sourceLang").value;
            const target = document.getElementById("targetLang").value;
            const resultBox = document.getElementById("translateResult");

            if (!text || !target) {
                resultBox.textContent = "Please provide text and target language.";
                return;
            }

            resultBox.textContent = "Translating...";

            try {
                const res = await fetch(`${API_BASE}/translate`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        text,
                        source_language: source,
                        target_language: target
                    })
                });

                const data = await res.json();

                resultBox.textContent =
                    `Detected language: ${data.detected_language}\n\n` +
                    `Translated text:\n${data.translated_text}`;

            } catch (err) {
                resultBox.textContent = "Error calling translate API.";
            }
        }

        /* -------------------------
           Document Upload + OCR
        -------------------------- */
        async function uploadAndProcessDocument() {
            const fileInput = document.getElementById("documentFile");
            const resultBox = document.getElementById("documentResult");

            if (!fileInput.files.length) {
                resultBox.textContent = "Please select a document.";
                return;
            }

            const file = fileInput.files[0];

            try {
                resultBox.textContent = "Requesting upload URL...";

                // 1Ô∏è‚É£ Get presigned URL
                const uploadMeta = await fetch(`${API_BASE}/documents/upload-url`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        file_name: file.name,
                        content_type: file.type || "application/octet-stream"
                    })
                }).then(r => r.json());

                // 2Ô∏è‚É£ Upload to S3
                resultBox.textContent = "Uploading document to S3...";

                await fetch(uploadMeta.upload_url, {
                    method: "PUT",
                    headers: {
                        "Content-Type": file.type || "application/octet-stream"
                    },
                    body: file
                });

                // 3Ô∏è‚É£ Process document
                resultBox.textContent = "Running OCR and sentiment analysis...";

                const response = await fetch(`${API_BASE}/documents/process`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        bucket: uploadMeta.bucket,
                        key: uploadMeta.key
                    })
                });

                const rawText = await response.text();
                console.log("RAW RESPONSE:", rawText);

                let result;
                try {
                    result = JSON.parse(rawText);
                } catch {
                    resultBox.textContent = "Invalid JSON returned from backend.";
                    return;
                }

                if (result.error) {
                    resultBox.textContent = "Backend error:\n" + result.error;
                    return;
                }

                resultBox.textContent =
                    `Sentiment: ${result.sentiment}\n` +
                    `Priority: ${result.priority}\n\n` +
                    `Extracted text preview:\n` +
                    result.extracted_text_preview;



            } catch (err) {
                console.error(err);
                resultBox.textContent = "Error processing document.";
            }
        }
    </script>

</body>

</html>