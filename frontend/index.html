<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Orion – Serverless Smart Inbox AI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f7fa;
            margin: 0;
            padding: 20px;
        }

        h1 {
            margin-bottom: 5px;
        }

        h2 {
            margin-top: 30px;
        }

        .card {
            background: white;
            padding: 20px;
            margin-top: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        textarea,
        select,
        input {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
        }

        button {
            margin-top: 10px;
            padding: 10px 15px;
            cursor: pointer;
        }

        .result {
            margin-top: 10px;
            background: #eef2f7;
            padding: 10px;
            border-radius: 5px;
            white-space: pre-wrap;
        }

        .error {
            color: red;
            margin-top: 10px;
        }
    </style>
</head>

<body>

    <h1>Orion – Serverless Smart Inbox AI</h1>
    <p>Multimodal serverless AI pipeline built on AWS</p>

    <!-- TEXT SENTIMENT -->
    <div class="card">
        <h2>Text Sentiment Analysis</h2>
        <textarea id="sentimentText" rows="4" placeholder="Type a message..."></textarea>
        <button onclick="analyzeSentiment()">Analyze</button>
        <div id="sentimentResult" class="result"></div>
    </div>

    <!-- TRANSLATION -->
    <div class="card">
        <h2>Text Translation</h2>
        <textarea id="translateText" rows="3" placeholder="Text to translate..."></textarea>

        <label>Source language (optional, ex: pt, en)</label>
        <input id="sourceLang" placeholder="auto" />

        <label>Target language (required, ex: en, pt)</label>
        <input id="targetLang" />

        <button onclick="translateText()">Translate</button>
        <div id="translateResult" class="result"></div>
    </div>

    <!-- TEXT TO SPEECH -->
    <div class="card">
        <h2>Text to Speech</h2>
        <textarea id="ttsText" rows="3" placeholder="Text to convert to speech..."></textarea>

        <label>Voice</label>
        <select id="voice">
            <option value="Camila">Camila (PT)</option>
            <option value="Joanna">Joanna (EN)</option>
            <option value="Matthew">Matthew (EN)</option>
        </select>

        <button onclick="textToSpeech()">Generate Audio</button>
        <div id="ttsResult"></div>
    </div>

    <!-- SPEECH TO TEXT -->
    <div class="card">
        <h2>Speech to Text</h2>

        <input type="file" id="audioFile" accept="audio/*" />

        <label>Language</label>
        <select id="sttLanguage">
            <option value="pt-BR">Portuguese (pt-BR)</option>
            <option value="en-US">English (en-US)</option>
        </select>

        <button onclick="speechToText()">Upload & Transcribe</button>

        <div id="sttResult" class="result"></div>
    </div>

    <script>
        const API_BASE_URL = "https://uyk8va4f3i.execute-api.us-east-1.amazonaws.com";

        async function analyzeSentiment() {
            const text = document.getElementById("sentimentText").value;
            if (!text) return alert("Please enter text");

            const res = await fetch(`${API_BASE_URL}/messages`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message: text })
            });

            const data = await res.json();
            document.getElementById("sentimentResult").innerText =
                JSON.stringify(data, null, 2);
        }

        async function translateText() {
            const text = document.getElementById("translateText").value;
            const target = document.getElementById("targetLang").value;
            const source = document.getElementById("sourceLang").value || "auto";

            if (!text || !target) {
                alert("Text and target language are required");
                return;
            }

            const res = await fetch(`${API_BASE_URL}/translate`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    text,
                    source_language: source,
                    target_language: target
                })
            });

            const data = await res.json();
            document.getElementById("translateResult").innerText =
                JSON.stringify(data, null, 2);
        }

        async function textToSpeech() {
            const text = document.getElementById("ttsText").value;
            const voice = document.getElementById("voice").value;

            if (!text) {
                alert("Text is required");
                return;
            }

            const res = await fetch(`${API_BASE_URL}/speech/synthesize`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ text, voice })
            });

            const data = await res.json();
            document.getElementById("ttsResult").innerHTML =
                `<audio controls src="${data.audio_url}"></audio>`;
        }

        async function speechToText() {
            const fileInput = document.getElementById("audioFile");
            const lang = document.getElementById("sttLanguage").value;
            const file = fileInput.files[0];

            if (!file) {
                alert("Select an audio file");
                return;
            }

            document.getElementById("sttResult").innerText = "Uploading audio...";

            // 1) get upload URL
            const uploadRes = await fetch(`${API_BASE_URL}/speech/transcribe/upload-url`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    file_name: file.name,
                    content_type: file.type
                })
            });

            const uploadData = await uploadRes.json();

            // 2) upload audio
            await fetch(uploadData.upload_url, {
                method: "PUT",
                headers: { "Content-Type": file.type },
                body: file
            });

            // 3) start transcription
            const processRes = await fetch(`${API_BASE_URL}/speech/transcribe/process`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    bucket: uploadData.bucket,
                    key: uploadData.key,
                    language: lang
                })
            });

            const processData = await processRes.json();
            document.getElementById("sttResult").innerText =
                `Transcription started.\nJob: ${processData.job_name}\nCheck S3 for results.`;
        }
    </script>

</body>

</html>